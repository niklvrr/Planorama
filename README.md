# Техническая спецификация проекта Planorama

## 1. Общее описание и цели

### 1.1 Техническое резюме
Planorama — это сервис для проектирования интерьера и закупки всего необходимого «под ключ», который объединяет 3D-конструктор, умный подбор комплектов под бюджет и требования, а также автоматическое формирование сметы и списка покупок.

## 2. Высокоуровневая архитектура

### 2.1 Архитектурный стиль: Монолит

## 3. Технологический стек

### 3.1 Фронтенд (Frontend)
- **Фреймворк:** React, версия 18.2.0
- **Язык:** TypeScript, версия 5.0.0
- **Сборщик:** Vite, версия 4.3.0
- **State Management:** Redux Toolkit, версия 1.9.0
- **Маршрутизация:** React Router DOM, версия 6.11.0
- **UI библиотека:** Material-UI (MUI), версия 5.13.0
- **HTTP клиент:** Axios, версия 1.4.0
- **Тестирование:** Jest + React Testing Library, версия 29.5.0
- **Линтинг:** ESLint + Prettier

### 3.2 Бэкенд (Backend)
- **Язык:** Go, версия 1.25.0
- **Архитектура:** Clean Architecture
- **Аутентификация:** JWT/OAuth 2.0
- **Документация API:** Swagger/OpenAPI

### 3.3 Слой данных
- **PostgreSQL** - бд для записей о факте сохранения, добавления и так далее; хранение данных пользователей
- **Redis** - бд для кэширования. Например, кэширование библиотеки моделей мебели
- **AWS S3** - хранилище для библиотеки моделей мебели, комнаты/пространства для каждого пользователя
- **Qdrant** - векторная бд для хранения векторизированных моделей мебели для сравнения с импортированными моделями

### 3.4 Инфраструктура и DevOps
- **Контейнеризация:** Docker
- **Оркестрация:** Docker Compose, K8s
- **CI/CD:** GitHub Actions
- **IaC:** Terraform
- **Веб-сервер:** Nginx
- **CDN:** Cloudflare
- **Мониторинг:** Prometheus + Grafana

## 4. Внешние интеграции и API

### 4.1 Интегрируемые сервисы
- **Платежи:** YooPay, тип интеграции: REST API
- **Разпознование 3D-модели по фото:** Tripo Ai, тип интеграции: REST API
- **Хранилище файлов:** AWS S3, тип интеграции: API

### 4.2 Политики повторных попыток
- **Стандартная политика:** Exponential backoff
- **Максимальное количество попыток:** 3
- **Таймаут между попытками:** 1s, 2s, 4s

## 5. Качество кода, тестирование и мониторинг

### 5.1 Тестирование
- **Unit тесты:** Инструменты: Jest, целевое покрытие: 80%
- **Интеграционные тесты:** Инструменты: Jest + Supertest, целевое покрытие: 70%
- **E2E тесты:** Инструменты: Cypress, целевое покрытие: 50%

### 5.2 Мониторинг и логирование
#### 5.2.1 Логирование
- **Уровни логирования:** error, warn, info, debug
- **Формат:** JSON (structured logging)
- **Транспорт:** Elastic Stack
- **Поля в логах:**
  - timestamp
  - level
  - message
  - userId
  - requestId

#### 5.2.2 Метрики и алертинг
- **Response time p95:** Тип: Gauge, порог для алерта: > 500ms
- **Error rate:** Тип: Counter, порог для алерта: > 1%
- **CPU usage:** Тип: Gauge, порог для алерта: > 80%
- **Memory usage:** Тип: Gauge, порог для алерта: > 90%

## 6. Производительность и масштабируемость

### 6.1 Целевые показатели
- **Time to Interactive (TTI):** < 3 секунд
- **First Contentful Paint (FCP):** < 1.5 секунд
- **Время ответа API (p95):** < 200ms
- **Availability:** 99.9%

### 6.2 Оптимизации
#### 6.2.1 Фронтенд
- Ленивая загрузка компонентов
- Code splitting по маршрутам
- Оптимизация изображений (WebP, lazy loading)
- Кэширование статических ресурсов

#### 6.2.2 Бэкенд
- Кэширование запросов к БД
- Оптимальные индексы в БД
- Connection pooling для БД
- Асинхронная обработка тяжелых операций

### 6.3 План масштабирования
- **Горизонтальное масштабирование:** Автоскейлинг группы инстансов бэкенда
- **Вертикальное масштабирование:** Увеличение размера инстанса БД
- **Геораспределение:** Развертывание в нескольких регионах